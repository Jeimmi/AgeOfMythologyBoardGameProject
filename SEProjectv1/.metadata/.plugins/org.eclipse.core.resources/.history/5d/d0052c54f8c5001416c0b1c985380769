import java.awt.image.BufferedImage;
import java.util.ArrayList;

public class BuildingCard extends Card {
	public BuildingCard(BufferedImage front, BufferedImage back,
			boolean permanent, String name, String firstDescription,
			String secondDescription, int value, int[] cost) {
		super(front, back, permanent, name, firstDescription,
				secondDescription, value, cost);
	}

	public ArrayList<Building> populateAffordable(Player player, int discount) {
		ArrayList<Building> affordable = new ArrayList<Building>();
		ArrayList<Building> toCheck = new ArrayList<Building>();
		
		for(int i = 0; i < player.buildingPool.size(); i++){
			if(!(toCheck.contains(player.buildingPool.get(i)))){
				toCheck.add(player.buildingPool.get(i));
			}
		}
		
		ArrayList<Building> tempList = new ArrayList<Building>();
		Building tempBuilding;
		for(int i = 0; i < discount; i++){
			for(int j = toCheck.size() - 1; j >= 0; j++){
				tempBuilding = new Building(toCheck.get(j));
				for(int k = 0; k < 4; k++){
					tempList.add((tempBuilding.reduce(tempBuilding, k)));
				}
			}
			discount --;
		}
		toCheck = tempList;
		
		for(int i = 0; i < toCheck.size(); i++){
			if(canAfford(player, toCheck.get(i)) && !(affordable.contains(toCheck.get(i)))){
				affordable.add(toCheck.get(i));
			}
		}
		
		return affordable;
	}
	
	public boolean canAfford(Player player, Building building){
		for(int i = 0; i < 4; i++){
			if(player.wallet[i] < building.cost[i]){
				return false;
			}
		}
		return true;
	}
	
	public int addBuilding(Player player, Building selection){
		int discountUsed = 0;
		for(int i = 0; i < 4; i ++){
			if(player.wallet[i] < selection.cost[i]){
				int temp = selection.cost[i] - player.wallet[i];
				discountUsed = discountUsed + temp;
				player.wallet[i] = player.wallet[i] - selection.cost[i] + temp;
			}
			else{
				player.wallet[i] = player.wallet[i] - selection.cost[i];
			}
		}
		player.buildingPool.remove(selection);
		player.city.add(selection);
		return discountUsed;
	}
	
	@Override
	public void execute(Game game) {
		UserInterface<Building> ui = new UserInterface<Building>();
		int discount = 0;
		int discountUsed = 0;
		if(game.activePlayer.city.contains(Building.Type.QUARRY)){
			discount = 1;
		}
		
		ArrayList<Building> options = populateAffordable(game.activePlayer, discount);
		ui.provideMenuOptions("Please select a building to build from the following:", 
				game.activePlayer, options);
		Building selection = ui.getPlayerSelection(options);
		int[] refund = {0, 0, 0, 0};
		int discountUsed = discountUsed + addBuilding(){
			
		}
		
		// TODO Auto-generated method stub
	}
}